# release changelog
# docker run -it -v "$(pwd)"/package:/go/src/github.com/pyama86/libnss_stns/package -w /go/src/github.com/pyama86/libnss_stns/package ubuntu:lib_stns dch -v 0.0.1 --create

FROM ubuntu:14.04
RUN apt-get update;apt-get install -y dh-make cdbs devscripts fakeroot lintian checkinstall dpatch quilt wget git dpkg-dev
RUN wget https://storage.googleapis.com/golang/go1.5.2.linux-amd64.tar.gz -P /tmp;tar zxvf /tmp/go1.5.2.linux-amd64.tar.gz -C /usr/local
ENV GOPATH /go
ENV PATH $PATH:/usr/local/go/bin:$GOPATH/bin

ADD ./ /go/src/github.com/pyama86/libnss_stns
WORKDIR /go/src/github.com/pyama86/libnss_stns
RUN cp build/ubuntu/ssh-stns-wrapper package/deb/debian/;go get github.com/tools/godep;godep restore

RUN go get github.com/tools/godep;godep restore
RUN go build -buildmode=c-shared -o package/deb/debian/libnss_stns.so libnss_stns.go entry.go passwd.go shadow.go group.go

WORKDIR /go/src/github.com/pyama86/libnss_stns/package/deb/
CMD debuild --no-tgz-check -uc -us;mv ../*.deb ../../releases/
