FROM pyama/stns:centos_build
ADD ./ /go/src/github.com/STNS/libnss_stns
WORKDIR /go/src/github.com/STNS/libnss_stns
RUN chown root:root -R /go/src/github.com/STNS/libnss_stns/package/RPM && \
echo '%_topdir /go/src/github.com/STNS/libnss_stns/package/RPM' > ~/.rpmmacros && \
echo '%_signature gpg' >> ~/.rpmmacros && \
echo '%_gpg_name stns-server' >> ~/.rpmmacros && \
cp binary/libnss-stns.so  package/RPM/BUILD/libnss_stns.so && \
cp binary/ssh-stns-wrapper package/RPM/BUILD/ssh_stns_wrapper
CMD rpmbuild --target x86_64 -ba package/RPM/SPECS/libnss_stns.spec && cp package/RPM/RPMS/x86_64/* binary/
